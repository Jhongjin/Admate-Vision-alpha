/**
 * 1·2·5·7·8호선만 사용. 실제 서울 지하철 역명 화이트리스트 + 역명→호선 매칭.
 * OCR로 역명이 인식되면 매칭된 호선으로 자동 추출(예: 여의도 → 5호선).
 * 3·4·6·9호선 등 나머지 호선 정보는 제외.
 */

const LINES = ["1호선", "2호선", "5호선", "7호선", "8호선"] as const;
export type SupportedLine = (typeof LINES)[number];

/** 역명 → 호선 (1,2,5,7,8만). 환승역은 대표 한 호선만 매핑 */
const STATION_TO_LINE: Record<string, SupportedLine> = {
  // 1호선
  서울역: "1호선",
  시청: "1호선",
  종각: "1호선",
  종로3가: "1호선",
  종로5가: "1호선",
  동대문: "1호선",
  동대문역사문화공원: "1호선",
  신설동: "1호선",
  제기동: "1호선",
  청량리: "1호선",
  동묘앞: "1호선",
  신도림: "1호선",
  도림천: "1호선",
  구로: "1호선",
  가산디지털단지: "1호선",
  독산: "1호선",
  금천구청: "1호선",
  광명: "1호선",
  석수: "1호선",
  관악: "1호선",
  안양: "1호선",
  명학: "1호선",
  금정: "1호선",
  군포: "1호선",
  당정: "1호선",
  의왕: "1호선",
  성균관대: "1호선",
  화서: "1호선",
  수원: "1호선",
  구일: "1호선",
  개봉: "1호선",
  오류동: "1호선",
  온수: "1호선",
  역곡: "1호선",
  소사: "1호선",
  부천: "1호선",
  중동: "1호선",
  송내: "1호선",
  부개: "1호선",
  부평: "1호선",
  백운: "1호선",
  동암: "1호선",
  간석: "1호선",
  주안: "1호선",
  도화: "1호선",
  제물포: "1호선",
  도원: "1호선",
  동인천: "1호선",
  인천: "1호선",
  // 2호선
  을지로입구: "2호선",
  을지로3가: "2호선",
  을지로4가: "2호선",
  신당: "2호선",
  상왕십리: "2호선",
  한양대: "2호선",
  뚝섬: "2호선",
  성수: "2호선",
  건대입구: "2호선",
  구의: "2호선",
  강변: "2호선",
  잠실나루: "2호선",
  잠실: "2호선",
  잠실새내: "2호선",
  종합운동장: "2호선",
  삼성: "2호선",
  선릉: "2호선",
  역삼: "2호선",
  강남: "2호선",
  교대: "2호선",
  서초: "2호선",
  방배: "2호선",
  사당: "2호선",
  낙성대: "2호선",
  서울대입구: "2호선",
  봉천: "2호선",
  신림: "2호선",
  신대방: "2호선",
  구로디지털단지: "2호선",
  대림: "2호선",
  문래: "2호선",
  영등포구청: "2호선",
  당산: "2호선",
  합정: "2호선",
  홍대입구: "2호선",
  이대: "2호선",
  신촌: "2호선",
  아현: "2호선",
  충정로: "2호선",
  용답: "2호선",
  신답: "2호선",
  용두: "2호선",
  도림동: "2호선",
  양천구청: "2호선",
  신정네거리: "2호선",
  까치산: "2호선",
  // 5호선
  방화: "5호선",
  개화산: "5호선",
  김포공항: "5호선",
  송정: "5호선",
  마곡: "5호선",
  발산: "5호선",
  우장산: "5호선",
  화곡: "5호선",
  신정: "5호선",
  목동: "5호선",
  오목교: "5호선",
  양평: "5호선",
  영등포시장: "5호선",
  신길: "5호선",
  여의도: "5호선",
  여의나루: "5호선",
  마포: "5호선",
  공덕: "5호선",
  애오개: "5호선",
  서대문: "5호선",
  광화문: "5호선",
  청구: "5호선",
  신금호: "5호선",
  행당: "5호선",
  왕십리: "5호선",
  마장: "5호선",
  답십리: "5호선",
  장한평: "5호선",
  군자: "5호선",
  능동: "5호선", // 군자역 별칭 (군자(능동))
  아차산: "5호선",
  광나루: "5호선",
  천호: "5호선",
  강동: "5호선",
  길동: "5호선",
  굽은다리: "5호선",
  명일: "5호선",
  고덕: "5호선",
  상일동: "5호선",
  강일: "5호선",
  미사: "5호선",
  하남풍산: "5호선",
  하남시청: "5호선",
  하남검단: "5호선",
  // 7호선
  장암: "7호선",
  도봉산: "7호선",
  수락산: "7호선",
  마들: "7호선",
  노원: "7호선",
  중계: "7호선",
  하계: "7호선",
  공릉: "7호선",
  먹골: "7호선",
  중화: "7호선",
  상봉: "7호선",
  면목: "7호선",
  사가정: "7호선",
  용마산: "7호선",
  중곡: "7호선",
  어린이대공원: "7호선",
  자양: "7호선",
  청담: "7호선",
  반포: "7호선",
  내방: "7호선",
  남성: "7호선",
  숭실대입구: "7호선",
  상도: "7호선",
  장승배기: "7호선",
  신대방삼거리: "7호선",
  보라매: "7호선",
  신풍: "7호선",
  남구로: "7호선",
  철산: "7호선",
  광명사거리: "7호선",
  천왕: "7호선",
  까치울: "7호선",
  부천종합운동장: "7호선",
  춘의: "7호선",
  신중동: "7호선",
  부천시청: "7호선",
  상동: "7호선",
  삼산체육관: "7호선",
  굴포천: "7호선",
  부평구청: "7호선",
  산곡: "7호선",
  석남: "7호선",
  // 8호선
  암사: "8호선",
  강동구청: "8호선",
  몽촌토성: "8호선",
  석촌: "8호선",
  송파: "8호선",
  문정: "8호선",
  장지: "8호선",
  복정: "8호선",
  남위례: "8호선",
  산성: "8호선",
  남한산성입구: "8호선",
  단대오거리: "8호선",
  신흥: "8호선",
  수진: "8호선",
  모란: "8호선",
};

/** 역번호(3자리) → 역명. 호선 추정만 되고 역명 OCR이 실패한 경우 보조용(1·2·5·7·8호선). */
const STATION_NUMBER_TO_STATION: Record<number, string> = {
  // 5호선 (501 방화 ~ 543 하남검단, 544=군자 일부 표기)
  501: "방화", 502: "개화산", 503: "김포공항", 504: "송정", 505: "마곡", 506: "발산", 507: "우장산",
  508: "화곡", 509: "신정", 510: "목동", 511: "오목교", 512: "양평", 513: "영등포시장", 514: "신길",
  515: "여의도", 516: "여의나루", 517: "마포", 518: "공덕", 519: "애오개", 520: "서대문", 521: "광화문",
  522: "청구", 523: "신금호", 524: "행당", 525: "왕십리", 526: "마장", 527: "답십리", 528: "장한평",
  529: "군자", 530: "아차산", 531: "광나루", 532: "천호", 533: "강동", 534: "길동", 535: "굽은다리",
  536: "명일", 537: "고덕", 538: "상일동", 539: "강일", 540: "미사", 541: "하남풍산", 542: "하남시청", 543: "하남검단",
  544: "군자", // 일부 역명판 표기
};

const SEOUL_METRO_STATION_NAMES = new Set<string>(Object.keys(STATION_TO_LINE));

/** 괄호·공백 제거 후 비교용 정규화 */
function normalizeForMatch(name: string): string {
  return name
    .replace(/\s+/g, "")
    .replace(/\s*\([^)]*\)\s*/g, "")
    .trim();
}

/**
 * 1·2·5·7·8호선 역명인지 여부.
 */
export function isKnownStationName(name: string): boolean {
  const n = normalizeForMatch(name);
  if (!n || n.length < 2) return false;
  return SEOUL_METRO_STATION_NAMES.has(n);
}

/**
 * 역명에 매칭된 호선 반환 (1·2·5·7·8만).
 * 역명이 화이트리스트에 있으면 해당 호선, 없으면 null.
 */
export function getLineForStation(name: string): SupportedLine | null {
  const n = normalizeForMatch(name);
  if (!n) return null;
  return STATION_TO_LINE[n] ?? null;
}

/** 1·2·5·7·8호선인지 여부 */
export function isSupportedLine(line: string): boolean {
  const t = line.trim();
  return LINES.includes(t as SupportedLine);
}

/**
 * 역번호(3자리)로 역명 조회. OCR에서 역명 미인식이어도 역번호만 있으면 역명 보조 추정용.
 */
export function getStationNameFromNumber(stationNumber: number): string | null {
  if (stationNumber < 100 || stationNumber > 999) return null;
  return STATION_NUMBER_TO_STATION[stationNumber] ?? null;
}
