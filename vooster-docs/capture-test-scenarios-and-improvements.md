# 촬영 플로우 테스트 시나리오 및 추가 수정 포인트

## 1. 테스트 시나리오

### 1.1 위치(역명) 촬영 → 광고 촬영 → 보고서 작성

| 단계 | 동작 | 기대 결과 |
|------|------|-----------|
| 1 | 촬영 페이지 진입 | 카메라 준비, "위치(역명) 촬영" + "위치 없음" 버튼 표시 |
| 2 | "위치(역명) 촬영" 클릭 | 1장 촬영 후 "위치 1장 · 광고 0장" 표시, "광고 촬영 (0/10)" 버튼으로 전환 |
| 3 | "광고 촬영" 클릭 (등록된 광고주 매칭되는 이미지) | OCR+매칭 성공 시 광고 1장 추가, 별도 안내 없음 |
| 4 | "광고 촬영" 클릭 (매칭 안 되는 이미지) | 하단 시트: "매칭되는 광고주가 없습니다" + 재촬영 시도 / 광고주 등록 |
| 5 | "재촬영 시도" 클릭 | 시트 닫힘, 광고 촬영 버튼 다시 활성화 |
| 6 | "이 위치 촬영 완료" 클릭 | 세션 저장 후 `/capture/confirm` 이동 |
| 7 | 확인 페이지 | 위치 사진·역명·호선·광고 사진·파일명 목록 표시, ZIP 다운로드 가능 |

### 1.2 위치 없음 → 광고 촬영 → 보고서 작성

| 단계 | 동작 | 기대 결과 |
|------|------|-----------|
| 1 | "위치 없음" 클릭 | "위치 없음 · 광고 0장" 표시, "광고 촬영 (0/10)" 버튼만 표시 |
| 2 | 광고 1장 이상 촬영 후 "보고서 작성하기" 클릭 | 세션 저장 후 `/capture/confirm` 이동 |
| 3 | 확인 페이지 | 위치(역명) 카드 미표시, 광고 사진·파일명(역명/호선 미인식) 표시 |

### 1.3 보고서 작성하기 버튼 동작

| 조건 | 동작 | 기대 결과 |
|------|------|-----------|
| 위치 1장 + 광고 0장 | "보고서 작성하기" 클릭 | `/reports`(보고 목록) 이동 |
| 위치 없음 + 광고 0장 | "보고서 작성하기" 클릭 | `/reports` 이동 |
| (위치 1장 또는 위치 없음) + 광고 1장 이상 | "보고서 작성하기" 클릭 | 세션 저장 후 `/capture/confirm` 이동 |

### 1.4 확인 페이지 · 파일명 · 다운로드

| 단계 | 동작 | 기대 결과 |
|------|------|-----------|
| 1 | 사용자직접기입명 입력 (예: DL16) | 모든 파일명에 해당 값 반영 |
| 2 | 일괄 수정 "5호선" → "8호선" 적용 | 선택/전체 대상 파일명 치환 |
| 3 | "ZIP 다운로드" 클릭 | 수정된 파일명으로 ZIP 다운로드 |

---

## 2. 추가 수정 포인트 (개선 후보)

### 2.1 광고주 매칭

- **API 광고주 연동**: 촬영/확인 페이지에서 `useAdvertisers()` 사용 중. API 실패 시 DUMMY_ADVERTISERS fallback. 필요 시 로딩/에러 UI 보강.
- **매칭 실패 시 촬영본 보관**: 현재는 매칭 실패 시 해당 이미지를 목록에 넣지 않음. “일단 저장하고 나중에 매칭” 옵션을 두는 설계 검토 가능.

### 2.2 UX

- **촬영 직후 피드백**: 광고 촬영 시 매칭 성공해도 토스트 등 짧은 피드백이 없음. “OO 광고주로 인식됨” 등 선택적 안내 가능.
- **위치 없음 취소**: "위치 없음" 선택 후 “위치 촬영으로 되돌리기” 버튼이 없음. 필요 시 상태 초기화 버튼 추가 검토.

### 2.3 확인 페이지

- **위치 없음 세션 라벨**: 역명/호선이 "역명 미인식", "호선 미인식"일 때 "위치 없음 촬영" 등 구분 라벨 표시 검토.
- **보고 발송**: "보고 발송" 클릭 시 실제 발송 API·이메일 연동은 미구현. PRD 기준으로 발송 플로우 설계 후 구현 필요.

### 2.4 성능 · 안정성

- **OCR 부하**: 광고 촬영마다 서버 OCR 호출. 연속 촬영 시 rate limit·로딩 표시 고려.
- **세션 크기**: `sessionStorage`에 이미지 base64 저장. 장수 많을 경우 용량 제한·압축 검토.

### 2.5 테스트 자동화

- **E2E**: Playwright 등으로 “위치 촬영 → 광고 촬영 → 확인 → ZIP 다운로드” 플로우 자동화 검토.
- **매칭 실패 시트**: “광고 촬영 → 매칭 실패 → 재촬영 시도 / 광고주 등록” 시나리오 케이스 추가.

---

## 3. 보고서 작성하기 버튼 판별 기준

- **촬영 완료**로 보는 조건: `canFinish = isAdMode && adImages.length >= 1`
  - `isAdMode`: 위치(역명) 1장 촬영됨 **또는** "위치 없음" 선택됨
  - `adImages.length >= 1`: 광고 촬영이 **최소 1장** 이상 추가됨
- **촬영 완료일 때**: "보고서 작성하기" 클릭 → 세션 저장 후 **`/capture/confirm`** 이동
- **촬영 미완료일 때**: "보고서 작성하기" 클릭 → **`/reports`** 이동
- "이 위치 촬영 완료"는 같은 조건(`canFinish`)에서만 노출되며, 클릭 시에도 `/capture/confirm`으로 이동

---

## 4. 광고주 매칭·OCR 목록 출처

- **OCR**: Google Cloud Vision API (`/api/capture/ocr`) 사용. 실패 시 클라이언트 Tesseract fallback.
- **광고주 목록(매칭 대상)**  
  - **촬영 페이지**: `useAdvertisers()`(Supabase API)로 조회. **목록이 비어 있거나 로딩 중이면** `DUMMY_ADVERTISERS`(dummy-advertisers.ts) 사용.  
  - **확인 페이지**: `DUMMY_ADVERTISERS` 사용(파일명 생성용).  
  - Supabase에 광고주가 1명 이상 등록되어 있으면 API 목록으로 매칭, 없으면 DUMMY 목록(브이아이피자산, 에스에스지닷컴 등)으로 매칭

---

## 5. 문서/설계 정리

- **서버 저장 제거**: `capture-save-and-filename-edit.md`의 "서버 저장(업로드)" 섹션은 현재 미사용(기능 제거). ZIP 다운로드만 사용 시 해당 문단 정리 또는 “보류” 표기 권장.
