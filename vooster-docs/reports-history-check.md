# 보고 목록에 발송 내역이 안 나올 때

## 1. 구현 전 발송건 (집계되지 않은 경우)

**보고 이력 DB 저장**은 아래가 배포된 **이후** 발송한 건만 목록에 표시됩니다.

- `vision_ocr_reports` 테이블 생성 마이그레이션 (`0005_vision_ocr_reports.sql`)
- POST `/api/capture/report` 에서 이메일 발송 성공 시 위 테이블에 insert 하는 로직

따라서 **위 구현/배포 전에 발송한 보고는 DB에 없으므로 목록에 나오지 않는 것이 정상**입니다.  
이메일 자체는 Resend로 발송되었을 수 있으나, 당시에는 이력을 저장하지 않았습니다.

---

## 2. 구현 후 발송했는데도 안 나오는 경우 (유실/문제 가능성)

구현 배포 **이후**에 발송했는데도 목록에 안 나온다면 아래를 순서대로 확인하세요.

### 2.1 프로덕션 DB에 마이그레이션 적용 여부

- **Supabase 프로덕션 프로젝트**에서 `vision_ocr_reports` 테이블이 있어야 합니다.
- 없으면: Supabase 대시보드 → SQL Editor에서 `supabase/migrations/0005_vision_ocr_reports.sql` 내용 실행  
  또는 로컬에서 `npx supabase db push` (프로덕션 연결 시) 로 마이그레이션 적용.

테이블이 없으면:

- 보고 발송 API는 **이메일 발송까지는 성공**하고 200을 반환하지만,
- `vision_ocr_reports` insert 는 실패하고,  
  최신 코드에서는 **"보고 메일은 발송되었으나 이력 저장에 실패했습니다"** 토스트가 뜹니다.

### 2.2 환경 변수 (Supabase 연결)

- Vercel(또는 사용 중인 호스팅)의 **프로덕션 환경 변수**에  
  `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` 가 올바르게 설정되어 있는지 확인.
- 잘못되었거나 없으면 insert/select 모두 실패할 수 있습니다.

### 2.3 한 건 다시 발송해서 확인

- 마이그레이션 적용 및 환경 변수 확인 후, **한 건 다시 보고 발송**해 보세요.
- 성공 시:
  - **이력 저장 성공**: "보고 발송 완료" 만 표시되고, 보고 목록에 해당 건이 나타나야 합니다.
  - **이력 저장 실패**: "보고 메일은 발송되었으나 이력 저장에 실패했습니다. (DB 마이그레이션 또는 연결 확인)" 이 표시됩니다.  
    → 위 2.1, 2.2 다시 확인.

---

## 3. 요약

| 상황 | 설명 |
|------|------|
| 구현/배포 **전** 발송 | DB에 저장 로직이 없었으므로 목록에 없음 → **정상** |
| 구현/배포 **후** 발송인데 목록에 없음 | 마이그레이션 미적용 또는 Supabase 연결 문제 가능 → **2.1~2.3 확인** |
| 발송 후 "이력 저장에 실패했습니다" 토스트 | DB insert 실패(테이블 없음 또는 연결 오류) → **2.1, 2.2 확인** |
